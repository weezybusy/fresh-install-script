#!/bin/bash
# Author: Vitaliy Pisnya

DIRS=(~/.vim ~/.moc ~/.minidlna ~/.local/bin)
DOTS=~/Templates/dotfiles
STUFF=/media/$USER/stuff
TELEGRAMDIR=~/.local/bin/telegram
WORK=/media/$USER/work

# Create needed directories.
let i=0
for dir in "${DIRS[@]}"; do
        mkdir -p $dir
done

# Install apps.
sudo apt -y install compton xbacklight pavucontrol redshift gcc valgrind make \
        glibc-source tmux python3-pip moc qalculate gparted vim minidlna
pip3 install --upgrade --user pip youtube-dl pyradio

# Download dot-files.
git clone https://github.com/weezybusy/dotfiles.git $DOTS

# Download vim colorscheme.
git clone https://github.com/morhetz/gruvbox.git ~/.vim/gruvbox

# Make links.
if mount | grep $STUFF > /dev/null; then
        cp -r $STUFF/apps/telegram ~/.local/bin
        chmod +x $TELEGRAMDIR/Telegram
        chmod +x $TELEGRAMDIR/Updater
        ln -svf $STUFF/music/* ~/Music/
        ln -svf $STUFF/videos/* ~/Videos/
fi

if mount | grep $WORK > /dev/null; then
        ln -svf $WORK/* ~/Documents/
fi

if [ -f ~/Documents/lost+found ]; then
        rm ~/Documents/lost+found
fi

ln -svf $DOTS/{.bash_aliases,.bashrc,.gdbinit,.gitconfig,.vimrc,.Xresources,.tmux.conf,.profile} ~
ln -svf $DOTS/{compton.conf,redshift.conf,fontconfig} ~/.config
ln -svf ~/.vim/gruvbox/colors ~/.vim
ln -svf $DOTS/config ~/.moc

# Setup openbox.
mv ~/.config/openbox/lxde-rc.xml ~/.config/openbox/lxde-rc.xml.bak
ln -svf $DOTS/lxde-rc.xml ~/.config/openbox
ln -svf $DOTS/autostart ~/.config/lxsession/LXDE

# Setup minidlna.
sudo mv /etc/minidlna.conf /etc/minidlna.conf.bak
sudo mv /etc/init.d/minidlna /etc/init.d/minidlna.bak
ln -svf $DOTS/minidlna.conf ~/.minidlna
ln -svf $DOTS/minidlna ~/.local/bin
chmod +x ~/.local/bin/minidlna

# Unpack glibc source.
if [ ! -d /usr/src/glibc/glibc-2.19 ]; then
        sudo tar xf /usr/src/glibc/glibc-2.19.tar.xz -C /usr/src/glibc
        sudo rm /usr/src/glibc/glibc-2.19.tar.xz
fi
